\section{Обоснование корректности}
\label{sec:explanation}
Будем считать, что единственный вид атак, которым подвергается подписанная карта --- аддитивный случайный шум, примененный к координатам вершин, 
так как сопоставление множества вершин оригинальной и атакованной карты, применяемое в процедуре извлечения ЦВЗ базового алгоритма 
(\ref{sec:base}), позволяет свести все другие атаки также к добавлению к координатам вершин 
небольшой случайной (с точки зрения злоумышленника) величины.

Рассмотрим простейшую модель. Пусть действительное число $x$, чтобы закодировать бит $b = \pm 1$, преобразуется в $x' = x + b \alpha$, 
где $\alpha$~---~некоторая константа. Затем $x'$ атакуется случайным шумом c амплитудой $\sigma$, то есть преобразуется в $x'' = x' + y$,
где $y$ --- случайная величина с функцией распределения $F(t) = \Phi(t / \sigma)$, $\Phi$ --- функция Лапласа. Для извлечения бита вычисляется
$b' = \sgn(x'' - x)$. Вероятность того, что бит будет правильно извлечен, равна 
$
P[\sgn(x'' - x) = b] = P[\sgn(b \alpha + n) = b] = F(\alpha) = \Phi(\alpha / \sigma).
$

Чуть усложним модель. Пусть теперь для кодирования одного бита $b$ используется набор $\left\{x_j\right\}_{j=1}^n$
из $n=2k+1$ вещественных чисел, каждое из которых преобразуется также как в предыдущей модели,
для извлечения бита вычисляется $\sgn\left(\sum_{j=1}^n b_j'\right)$. Вероятность того, что бит будет извлечен правильно, равна 
$P\left(\left|\{j | b_j' = b, j = 1..n\}\right| \ge k + 1\right) = \sum_{j=0}^k \binom{n}{j} p^{n-j}(1-p)^j$, где $p = \Phi(\alpha / \sigma)$.
Если ввести обозначение $q = 1 - p$, $P_n = \sum_{j=0}^k \binom{n}{j} p^{n-j} q^j$, то будет верно следующее утверждение:
\begin{equation}
\label{prob_rec}
P_n = P_{n-2} + \binom{n-2}{k-1} p^k q^k (p - q),
\end{equation}
откуда видно, что для увеличения надежности кодирования бита можно увеличивать как $\alpha$, так и $n$. 
\begin{proof}
\begin{multline*}
\textstyle P_n = \binom{n}{0} p^{n} + \binom{n}{1} p^{n-1} q + \binom{n}{2} p^{n-2} q^2 + \ldots + \binom{n}{k-1} p^{k+2} q^{k-1} + \binom{n}{k} p^{k+1} q^k = \\
\shoveleft \textstyle = \left[\binom{n-1}{0} p^n + \binom{n-1}{0} p^{n-1} q \right] + \left[\binom{n-1}{1} p^{n-1} q + \binom{n-1}{1} p^{n-2} q^2 \right]
+ \ldots \\
\shoveright{\textstyle + \left[\binom{n-1}{k-1}p^{k+2}q^{k-1} + \binom{n-1}{k-1}p^{k+1}q^k \right] + \binom{n-1}{k}p^{k+1}q^k =} \\
\shoveleft \textstyle = \binom{n-1}{0} p^{n-1} + \binom{n-1}{1}p^{n-2}q + \ldots + \binom{n-1}{k-1}p^{k+1}q^{k-1} + \binom{n-1}{k} p^{k+1} q^k = \\
\shoveleft \textstyle = \left[\binom{n-2}{0}p^{n-1} + \binom{n-2}{0} p^{n-2} q \right] + \left[\binom{n-2}{0}p^{n-1} + \binom{n-2}{0} p^{n-2} q \right] +
\ldots \\
\shoveright{\textstyle + \left[\binom{n-2}{k-2}p^{k+2}q^{k-2} + \binom{n-2}{k-2}p^{k+1}q^{k-1} \right] + 
\binom{n-2}{k-1}p^{k+1}q^{k-1} + \binom{n-1}{k}p^{k+1}q^{k} = }\\
\shoveleft \textstyle = \left[\binom{n-2}{0} p^{n-2} + \binom{n-2}{1}p^{n-3}q + \ldots + \binom{n-2}{k-2}p^{k+1}q^{k-2} \right] + 
\binom{n-2}{k-1}p^{k+1}q^{k-1} + \binom{n-1}{k}p^{k+1}q^{k} = \\
\shoveleft \textstyle = P_{n-2} - \binom{n-2}{k-1}p^{k}q^{k-1} + \binom{n-2}{k-1}p^{k+1}q^{k-1} + \binom{n-1}{k}p^{k+1}q^{k} = \\ 
\shoveleft \textstyle = P_{n-2} + \binom{n-2}{k-1} p^{k}q^{k-1} (p - 1) + \left(\binom{n-2}{k-1} + \binom{n-2}{k} \right) p^{k+1}q^{k} = \\
\textstyle = P_{n-2} - \binom{n-2}{k-1} p^{k}q^{k} + 2p \binom{n-2}{k-1} p^k q^k = P_{n-2} + \binom{n-2}{k-1} p^k q^k (p - q). 
\end{multline*}
\end{proof}

Таким образом, для кодирования внедрения сообщения, состоящего из $m$ бит, можно было бы просто изменить координаты $m * n$ вершин карты на величину равную по модулю $\alpha$, где
$n$ и $\alpha$ выбираются из расчета того, какой амплитуды случайному шуму должны противостоять водяные знаки. Почему же все-таки выгоднее работать в частотной области?

Во-первых, длина внедряемого сообщения, как правило, много меньше числа вершин карты, а значит, чтобы изменение координат было равномерно 
по всем вершинам, надо выбирать достаточно большое $n$. В то же время из формулы~(\ref{prob_rec}) видно, что с ростом $n$ вероятность 
правильного извлечения сообщения растет довольно медленно, а значит с точки зрения устойчивости к атакам при одинаковом 
суммарном изменении координат вершин было бы выгодно брать небольшое значение $n$ и большое значение~$\alpha$.

Во-вторых, отметим, что переход от естественного базиса $\mathbb{R}^d$ к собственным векторам лапласиана, это есть в точности преобразование Фурье. 
А преобразование Фурье обладает принципом неопределенности, то есть, грубо говоря, невозможно произвольно сконцентрировать и функцию и ее Фурье-образ.
В частности для дискретного преобразования Фурье (ДПФ) в работе~\cite{Uncertainty} этот принцип сформулирован следующим образом. 
Пусть $\{\mathbf{j}\}_{j=0}^{d-1}$, $\{\tilde{\mathbf{k}}\}_{k=0}^{d-1}$ --- два ортонормированных базиса $\mathbb{C}^d$ связанных ДПФ:
\begin{equation*}
\textstyle |\tilde{\mathbf{k}} \rangle = \sum\limits_{j=0}^{d-1} \frac{e^{i 2\pi j k / d}}{\sqrt{d}} |\mathbf{j} \rangle,\mbox{    }
|{\mathbf{j}} \rangle = \sum\limits_{k=0}^{d-1} \frac{e^{i 2\pi j k / d}}{\sqrt{d}} |\tilde{\mathbf{k}} \rangle.
\end{equation*}
Если рассмотреть унитарные операторы 
$$
U = \sum\limits_{j=0}^{d-1} e^{i 2\pi j / d} |\mathbf{j} \rangle \langle \mathbf{j} |,\mbox{    }
U = \sum\limits_{k=0}^{d-1} e^{i 2\pi k / d} |\tilde{\mathbf{k}} \rangle \langle \tilde{\mathbf{k}} |,
$$
то их дисперсии
$$
\textstyle
\Delta U^2 = 1 - |\langle \psi | U | \psi \rangle |^2, \mbox{   }
\Delta V^2 = 1 - |\langle \psi | V | \psi \rangle |^2, \mbox{   } |\psi|^2 = 1,
$$
будут связаны соотношением $\Delta U^2 \Delta V^2 \ge \frac{\pi^2}{d^2}$ или $\Delta U^2 = (0|1), \Delta V^2 = (1|0)$. Отсюда в частности следует, что если вектор $\psi$ имеет координаты 
$\left(\frac{1}{\sqrt{d}}, \frac{1}{\sqrt{d}}, \ldots, \frac{1}{\sqrt{d}}\right)$ в одном базисе, он равен какому-то базисному вектору другого базиса.
В случае преобразования используемого в базовом алгоритме (и его модификации предложенной в данной работе) это тоже выполняется. Действительно, константный вектор на вершинах графа 
является его собственным вектором соответсвующим собственному числу $0$.

Считая, что вектор шума состоит из случайных величин с мат. ожиданием $0$ и одинаковой дисперсией, независимо заданных для каждой вершины графа, можно утверждать, 
что после преобразования Фурье они сконцентрируются около нескольких частот, а значит, большинство внедренных битов будет правильно извлечено с высокой вероятностью.
